<ion-header>

	<ion-navbar>
		<ion-title>
			<span>Place Order</span>
		</ion-title>
	</ion-navbar>
</ion-header>

<ion-content padding>
<!--
	<div *ngIf="orderIsOutstanding" class="order-is-outstanding">
		<p>Your order has been placed!</p>
		<ion-card>
			<ion-card-header>
				Pickup
			</ion-card-header>
			<ion-card-content>
				<p style="font-weight:bold">
					{{state.outstandingOrder.pickupLocation.nextPickup}}
				</p>
				<p>
					{{state.outstandingOrder.pickupLocation.abbreviatedName}}
				</p>
			</ion-card-content>
		</ion-card>

		<ion-card>
			<ion-card-header>
				Order
				<span style="float:right" *ngIf="state.outstandingOrder.foodItems.length > 0">
					<span *ngIf="showOutstandingOrderPreview === false">{{state.outstandingOrder.foodItems.length}} items</span>
					<ion-icon (click)="showOutstandingOrderPreview = true" *ngIf="showOutstandingOrderPreview === false" style="margin-left:4px;" ios="ios-arrow-down" md="md-arrow-down"></ion-icon>
					<ion-icon (click)="showOutstandingOrderPreview = false" *ngIf="showOutstandingOrderPreview === true" style="margin-left:4px;" ios="ios-arrow-up" md="md-arrow-up"></ion-icon>
				</span>
			</ion-card-header>
			<ion-card-content *ngIf="showOutstandingOrderPreview">
				<ion-list>
					<ion-item *ngFor="let item of state.outstandingOrder.foodItems">
						<span>{{item.quantityOrdered}}
							<span *ngIf="item.quantityOrdered === 1">{{item.unitLabelSingular}}</span>
							<span *ngIf="item.quantityOrdered > 1">{{item.unitLabelPlural}}</span>
							{{item.name}}</span>
						<span style="float:right">{{item.unitCost * item.quantityOrdered | currency:'USD':true:'1.0-2'}}</span>
					</ion-item>
				</ion-list>
			</ion-card-content>
		</ion-card>
		<p>All orders are final</p>
		<button style="padding-left:14px;" ion-button color="light" round>Add Alert</button>
		<button style="padding-left:14px;" ion-button color="light" round>Add to Calendar</button>
	</div>
-->
<!--*ngIf="!orderIsOutstanding"-->
	<ion-grid no-padding class="step-progress-bar">
		<ion-row justify-content-center>
			<ion-col text-center col-sm [ngClass]="{'passed': (segmentTitle === 'checkout' || segmentTitle === 'pickup'), 'completed': userHasSuccessfullyCompletedShoppingStep, 'active': (segmentTitle === 'shop') }">
				<div (click)="goToSegment('shop')">
					<ion-icon [name]="userHasSuccessfullyCompletedShoppingStep ? 'checkmark' : 'cart'"></ion-icon>
					<p>Shop</p>
				</div>
			</ion-col>
			<ion-col text-center col-sm [ngClass]="{'passed': (segmentTitle === 'pickup'), 'completed': userHasSuccessfullyCompletedCheckoutStep, 'active': (segmentTitle === 'checkout') }">
				<div (click)="checkout()">
					<ion-icon [name]="userHasSuccessfullyCompletedCheckoutStep ? 'checkmark' :'card'"></ion-icon>
					<p>Checkout</p>
				</div>
			</ion-col>
			<ion-col text-center col-sm [ngClass]="{'active': (segmentTitle === 'pickup') }">
				<div>
					<ion-icon [name]="'walk'"></ion-icon>
					<p>Pickup</p>
				</div>
			</ion-col>

		</ion-row>
	</ion-grid>



	<div>
		<ion-list *ngIf="segmentTitle === 'shop'">
			<div *ngFor="let foodCategory of state.foodCategories">

				<div *ngIf="foodCategory.expanded === true">
					<ion-list-header (click)="toggle(foodCategory)">
						<ion-avatar item-left>
							<img src="assets/images/{{foodCategory.imageSvgName}}.jpeg">
						</ion-avatar>
						{{foodCategory.label}}
						<ion-badge *ngIf="foodCategory.quantityOrdered > 0" style="margin-left:20px">{{foodCategory.quantityOrdered}}</ion-badge>
						<ion-icon style="float:right" ios="ios-arrow-up" md="md-arrow-up"></ion-icon>
					</ion-list-header>


					<ion-item-sliding #slidingItem *ngFor="let item of foodCategory.foodItems">
						<ion-item text-wrap>
							<div>
								<span *ngIf="item.quantityOrdered === 0" class="indent"> </span>
								<ion-icon *ngIf="item.quantityOrdered > 0" class="no-indent" name="checkmark"></ion-icon>
								{{item.name}}
								<span class="swipe-left">swipe left</span>
							</div>
							<div class="qty-details indent">

								<span *ngIf="item.quantityOrdered === 1" class="qty-ordered"> ({{item.quantityOrdered}} {{item.unitLabelSingular}})</span>
								<span *ngIf="item.quantityOrdered > 1" class="qty-ordered"> ({{item.quantityOrdered}} {{item.unitLabelPlural}})</span>

								<span>{{item.unitCost | currency:'USD':true:'1.0-2'}} / {{item.unitLabelSingular}}</span>
							</div>
						</ion-item>
						<ion-item-options>
							<button ion-button color="secondary" icon-left (click)="add(foodCategory, item, slidingItem)">
								<ion-icon ios="ios-add" md="md-add"></ion-icon>
								Add
							</button>
							<button *ngIf="item.quantityOrdered > 0" ion-button color="primary" icon-left (click)="subtract(foodCategory, item, slidingItem)">
								<ion-icon ios="ios-remove" md="md-remove"></ion-icon>
								Subtract
							</button>
							<button ion-button color="light" icon-left (click)="openItemDetailsModal(slidingItem, item)">
								<ion-icon ios="ios-eye" md="md-eye"></ion-icon>
								Details
							</button>
						</ion-item-options>
					</ion-item-sliding>
<!--

					<ion-item *ngFor="let item of foodCategory.foodItems">
						<span style="margin-left:12px;"> </span>
						<ion-icon *ngIf="item.quantityOrdered > 0" ios="ios-checkmark-circle-outline" md="md-checkmark-circle-outline"></ion-icon>
						{{item.name}}
						<span *ngIf="item.quantityOrdered === 1" style="padding-left:4px;"> ({{item.quantityOrdered}} {{item.unitLabelSingular}})</span>
						<span *ngIf="item.quantityOrdered > 1"> ({{item.quantityOrdered}} {{item.unitLabelPlural}})</span>
						<span style="padding-left:4px;">{{item.unitCost | currency:'USD':true:'1.0-2'}} / {{item.unitLabelSingular}}</span>
						<ion-fab right bottom>
						    <button ion-fab color="light"><ion-icon name="arrow-dropleft"></ion-icon></button>

						    <ion-fab-list side="left">

								<button ion-fab color="secondary" icon-left (click)="add(foodCategory, item, slidingItem)">
									<ion-icon ios="ios-add" md="md-add"></ion-icon>
									Add
								</button>
								<button *ngIf="item.quantityOrdered > 0" ion-fab color="primary" icon-left (click)="subtract(foodCategory, item, slidingItem)">
									<ion-icon ios="ios-remove" md="md-remove"></ion-icon>
									Subtract
								</button>
								<button ion-fab color="light" icon-left (click)="openItemDetailsModal(slidingItem)">
									<ion-icon ios="ios-eye" md="md-eye"></ion-icon>
									Details
								</button>
							</ion-fab-list>
						</ion-fab>
					</ion-item>
-->

				</div>
				<ion-item *ngIf="foodCategory.expanded === false" (click)="toggle(foodCategory)">
					<ion-avatar item-left>
						<img src="assets/images/{{foodCategory.imageSvgName}}.jpeg">
					</ion-avatar>
					{{ foodCategory.label }}
					<ion-badge *ngIf="foodCategory.quantityOrdered > 0" style="margin-left:20px">{{foodCategory.quantityOrdered}}</ion-badge>
					<ion-icon style="float:right" ios="ios-arrow-down" md="md-arrow-down"></ion-icon>

				</ion-item>
			</div>
			<ion-row style="margin-top:12px;">
				<ion-col text-center>
					<button ion-button [color]="userHasSelectedAtLeastOneItem() ? 'secondary' : 'light'" (click)="checkout()" round>Next</button>
				</ion-col>
			</ion-row>

		</ion-list>

		<div *ngIf="segmentTitle === 'pickup'">
			<p style="margin-top:40px; padding-left:20px; margin-bottom:24px; font-size:1.6rem;" color="secondary">Your order has been placed!</p>
			<p style="margin-top:20px; padding-left:20px; margin-bottom:24px; font-size:1.6rem;" color="secondary">pickup: {{state.consumer.family.orderPickupSchedule.nextPickupDate | date:'EEE MMMM d, yyyy'}} &nbsp; {{state.consumer.family.orderPickupSchedule.formattedPickupTime}}</p>
			<p style="margin-top:20px; padding-left:20px; margin-bottom:24px; font-size:1.6rem;" color="secondary">{{state.consumer.family.orderPickupSchedule.address.name}}</p>

			<!--
			<p style="padding-left:16px; font-size:1.3rem;">Order Placed?</p>

			<ion-list no-lines inset>
				<ion-item *ngFor="let member of state.account.group.members">
					<ion-label>
						<span item-left>{{member.firstName}} {{member.lastName}}</span>
						<ion-icon class="checkmark_underline"[name]="'checkmark'"></ion-icon>
					</ion-label>
				</ion-item>
			</ion-list>
-->
<!--
			<table class="pickup">
				<thead>
					<tr>
						<td></td>
						<td>Order Placed</td>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let member of state.account.group.members">
						<td>{{member.firstName}} {{member.lastName}}</td>
						<td align="center"><ion-icon style="font-size: 2rem;" [name]="'checkmark'"></ion-icon></td>
					</tr>
				</tbody>
			</table>
		-->
<!--
			<ion-item  text-wrap>
			  <ion-label>Make this my default location</ion-label>
			  <ion-toggle [(ngModel)]="setDefaultLocation"></ion-toggle>
			</ion-item>
			<ion-list radio-group>
				<ion-item *ngFor="let loc of state.pickupLocations">
					<ion-label>
						<p>{{loc.abbreviatedName}} <ion-icon style="padding-left:10px;" name="pin"></ion-icon></p>
						<strong>{{loc.nextPickup}}</strong>
					</ion-label>
					<ion-radio  (ionSelect)="selectPickupLocation(loc)" [checked]="loc.selected === true"></ion-radio>
				</ion-item>
			</ion-list>
			<ion-row>
				<ion-col text-center>
					<button ion-button [color]="userHasSelectedAPickupLocation() ? 'secondary' : 'light'" (click)="goToSegment('shop')" round>Next</button>
				</ion-col>
			</ion-row>
-->
		</div>
		<div *ngIf="segmentTitle === 'checkout'">
<!--
			<ion-card>
				<ion-card-header>
					Pickup
				</ion-card-header>
				<ion-card-content *ngIf="state.orderInProgress.pickupLocation">
					<ion-list>
						<ion-item>
							{{state.orderInProgress.pickupLocation.nextPickup}}
							<ion-icon name="calendar" style="padding-left:20px;"></ion-icon>
						</ion-item>
						<ion-item>
							{{state.orderInProgress.pickupLocation.abbreviatedName}}

						</ion-item>
					</ion-list>
				</ion-card-content>
				<ion-card-content *ngIf="!state.orderInProgress.pickupLocation">
					<p ion-text color="danger">Please click on PICKUP above to select a pickup location</p>
				</ion-card-content>
			</ion-card>
-->
			<ion-card>
				<ion-card-header>
					Order
					<span style="float:right" *ngIf="state.orderInProgress.foodItems.length > 0">
						<span *ngIf="showOrderPreview === false">{{state.orderInProgress.foodItems.length}} </span>
						<span *ngIf="state.orderInProgress.foodItems.length === 1">item</span>
						<span *ngIf="state.orderInProgress.foodItems.length !== 1">items</span>
						<ion-icon (click)="showOrderPreview = true" *ngIf="showOrderPreview === false" style="margin-left:4px;" ios="ios-arrow-down" md="md-arrow-down"></ion-icon>
						<ion-icon (click)="showOrderPreview = false" *ngIf="showOrderPreview === true" style="margin-left:4px;" ios="ios-arrow-up" md="md-arrow-up"></ion-icon>
					</span>
				</ion-card-header>
				<ion-card-content *ngIf="state.orderInProgress.foodItems.length > 0 && showOrderPreview">
					<ion-list>
						<ion-item *ngFor="let item of state.orderInProgress.foodItems">
							<span>{{item.quantityOrdered}}
								<span *ngIf="item.quantityOrdered === 1">{{item.unitLabelSingular}}</span>
								<span *ngIf="item.quantityOrdered > 1">{{item.unitLabelPlural}}</span>
								{{item.name}}</span>
							<span style="float:right">{{item.unitCost * item.quantityOrdered | currency:'USD':true:'1.0-2'}}</span>
						</ion-item>
					</ion-list>
				</ion-card-content>
				<ion-card-content *ngIf="state.orderInProgress.foodItems.length === 0">
					<p ion-text color="danger">Please click on SHOP above to items to your order.</p>
				</ion-card-content>

			</ion-card>

			<ion-card>
				<ion-card-header>
					Total
					<span style="float:right">
						<span *ngIf="showTotalPreview === false">{{state.orderInProgress.totalCost | currency:'USD':true:'1.0-2'}}</span>
						<ion-icon (click)="showTotalPreview = true" *ngIf="showTotalPreview === false" style="margin-left:4px;" ios="ios-arrow-down" md="md-arrow-down"></ion-icon>
						<ion-icon (click)="showTotalPreview = false" *ngIf="showTotalPreview === true" style="margin-left:4px;" ios="ios-arrow-up" md="md-arrow-up"></ion-icon>
					</span>
				</ion-card-header>
				<ion-card-content *ngIf="showTotalPreview">
					<ion-list>
						<ion-item>
							<span>Account Credit</span>
							<span style="float:right">{{state.consumer.balance | currency:'USD':true:'1.0-2'}}</span>
						</ion-item>
						<ion-item>
							<span>Order Total</span>
							<span class="order-total">{{state.orderInProgress.totalCost | currency:'USD':true:'1.0-2'}}</span>
						</ion-item>
						<ion-item>
							<span>Projected Balance</span>
							<span style="float:right">{{(state.consumer.balance - state.orderInProgress.totalCost) | currency:'USD':true:'1.0-2'}}</span>
						</ion-item>
					</ion-list>
				</ion-card-content>
			</ion-card>
			<ion-row *ngIf="state.orderInProgress.foodItems.length > 0">
				<ion-col text-center>
					<button *ngIf="((state.consumer.balance - state.orderInProgress.totalCost) < 0)" ion-button color="secondary" round (click)="payWithPaypal()">Pay with paypal</button>
					<button *ngIf="((state.consumer.balance - state.orderInProgress.totalCost) >= 0)" ion-button color="secondary" round (click)="payWithPaypal()">Place order</button>
				</ion-col>
			</ion-row>


		</div>

	</div>

</ion-content>
