<ion-header>
	<ion-navbar>
		<ion-title>Place Order</ion-title>
	</ion-navbar>
	<ion-toolbar no-border-top>
		<ion-segment [(ngModel)]="segmentTitle">
			<ion-segment-button value="shop">
				Shop
			</ion-segment-button>
			<ion-segment-button value="pickup">
				Pickup
			</ion-segment-button>
			<ion-segment-button value="preview" (ionSelect)="preview()">
				Preview
			</ion-segment-button>
		</ion-segment>
	</ion-toolbar>
</ion-header>

<ion-content padding>

	<div [ngSwitch]="segmentTitle">

		<ion-list *ngSwitchCase="'shop'">

			<div *ngFor="let foodCategory of state.foodCategories">

				<div *ngIf="foodCategory.expanded === true">
					<ion-list-header (click)="toggle(foodCategory)">
						<ion-avatar item-left>
							<img src="assets/images/{{foodCategory.image}}">
						</ion-avatar>
						{{foodCategory.label}}
						<ion-icon style="float:right" ios="ios-arrow-up" md="md-arrow-up"></ion-icon>
					</ion-list-header>
					<ion-item-sliding #slidingItem *ngFor="let item of foodCategory.items">
						<ion-item>
							<span style="margin-left:12px;"> </span>
							<ion-icon *ngIf="item.quantity > 0" ios="ios-checkmark-circle-outline" md="md-checkmark-circle-outline"></ion-icon>
							{{item.name}}
							<span *ngIf="item.quantity === 1"> ({{item.quantity}} {{item.unitLabelSingular}})</span>
							<span *ngIf="item.quantity > 1"> ({{item.quantity}} {{item.unitLabelPlural}})</span>
						</ion-item>
						<ion-item-options>
							<button ion-button color="secondary" icon-left (click)="add(foodCategory, item, slidingItem)">
								<ion-icon ios="ios-add" md="md-add"></ion-icon>
								Add
							</button>
							<button *ngIf="item.quantity > 0" ion-button color="primary" icon-left (click)="subtract(foodCategory, item, slidingItem)">
								<ion-icon ios="ios-remove" md="md-remove"></ion-icon>
								Subtract
							</button>
							<button ion-button color="light" icon-left (click)="openModal(slidingItem)">
								<ion-icon ios="ios-eye" md="md-eye"></ion-icon>
								Details
							</button>
						</ion-item-options>
					</ion-item-sliding>
				</div>
				<ion-item *ngIf="foodCategory.expanded === false" (click)="toggle(foodCategory)">
					<ion-avatar item-left>
						<img src="assets/images/{{foodCategory.image}}">
					</ion-avatar>
					{{ foodCategory.label }}
					<ion-badge *ngIf="foodCategory.amt > 0" style="margin-left:20px">{{foodCategory.amt}}</ion-badge>
					<ion-icon style="float:right" ios="ios-arrow-down" md="md-arrow-down"></ion-icon>

				</ion-item>
			</div>
		</ion-list>

		<div *ngSwitchCase="'pickup'">
			<ion-card>
				<ion-item *ngFor="let loc of state.pickupLocations" (click)="selectPickupLocation(loc)">
					<ion-icon name="pin" item-left large></ion-icon>
					<p>
						<ion-icon icon-left *ngIf="loc.selected === true" ios="ios-checkmark-circle-outline" md="md-checkmark-circle-outline"></ion-icon>
						{{loc.abbreviatedName}} <ion-icon style="padding-left:10px;" small ios="ios-navigate-outline" md="md-navigate"></ion-icon>
					</p>
					<strong>{{loc.nextPickup}}</strong>
				</ion-item>
			</ion-card>

		</div>
		<div *ngSwitchCase="'preview'">

			<ion-card>
				<ion-card-header>
					Pickup
				</ion-card-header>
				<ion-card-content *ngIf="state.orderInProgress.pickupLocation">
					<p>
						{{state.orderInProgress.pickupLocation.abbreviatedName}}
						<ion-icon ios="ios-navigate-outline" md="md-navigate" style="padding-left:20px;"></ion-icon>
					</p>
					<p>
						{{state.orderInProgress.pickupLocation.nextPickup}}
						<ion-icon ios="ios-calendar-outline" md="md-calendar" style="padding-left:20px;"></ion-icon>
					</p>
				</ion-card-content>
				<ion-card-content *ngIf="!state.orderInProgress.pickupLocation">
					<p ion-text color="danger">Please click on PICKUP above to select a pickup location</p>
				</ion-card-content>
			</ion-card>

			<ion-card>
				<ion-card-header>
					Order
					<span style="float:right" *ngIf="state.orderInProgress.items.length > 0">
						<span *ngIf="showOrderPreview === false">{{state.orderInProgress.items.length}} items</span>
						<ion-icon (click)="showOrderPreview = true" *ngIf="showOrderPreview === false" style="margin-left:4px;" ios="ios-arrow-down" md="md-arrow-down"></ion-icon>
						<ion-icon (click)="showOrderPreview = false" *ngIf="showOrderPreview === true" style="margin-left:4px;" ios="ios-arrow-up" md="md-arrow-up"></ion-icon>
					</span>
				</ion-card-header>
				<ion-card-content *ngIf="state.orderInProgress.items.length > 0 && showOrderPreview">
					<ion-list>
						<ion-item *ngFor="let item of state.orderInProgress.items">
							<span>{{item.quantity}}
								<span *ngIf="item.quantity === 1">{{item.unitLabelSingular}}</span>
								<span *ngIf="item.quantity > 1">{{item.unitLabelPlural}}</span>
								{{item.name}}</span>
							<span style="float:right">{{item.unitCost * item.quantity | currency:'USD':true:'1.0-2'}}</span>
						</ion-item>
					</ion-list>
				</ion-card-content>
				<ion-card-content *ngIf="state.orderInProgress.items.length === 0">
					<p ion-text color="danger">Please click on SHOP above to items to your order.</p>
				</ion-card-content>

			</ion-card>

			<ion-card>
				<ion-card-header>
					Total
					<span style="float:right">
						<span *ngIf="showTotalPreview === false">{{state.orderInProgress.totalCost | currency:'USD':true:'1.0-2'}}</span>
						<ion-icon (click)="showTotalPreview = true" *ngIf="showTotalPreview === false" style="margin-left:4px;" ios="ios-arrow-down" md="md-arrow-down"></ion-icon>
						<ion-icon (click)="showTotalPreview = false" *ngIf="showTotalPreview === true" style="margin-left:4px;" ios="ios-arrow-up" md="md-arrow-up"></ion-icon>
					</span>
				</ion-card-header>
				<ion-card-content *ngIf="showTotalPreview">
					<ion-list>
						<ion-item>
							<span>Account Credit</span>
							<span style="float:right">{{state.account.balance | currency:'USD':true:'1.0-2'}}</span>
						</ion-item>
						<ion-item>
							<span>Order Total</span>
							<span style="float:right">{{state.orderInProgress.totalCost | currency:'USD':true:'1.0-2'}}</span>
						</ion-item>
						<ion-item>
							<span>Projected Balance</span>
							<span style="float:right">{{(state.account.balance - state.orderInProgress.totalCost) | currency:'USD':true:'1.0-2'}}</span>
						</ion-item>
					</ion-list>
				</ion-card-content>
			</ion-card>
			<ion-row *ngIf="state.orderInProgress.items.length > 0 && state.orderInProgress.pickupLocation">
				<ion-col text-center>
					<button ion-button color="secondary" round>Place Order</button>
				</ion-col>
			</ion-row>


		</div>

	</div>

</ion-content>
